
/* (c) Optimax Software  2010-  2012 */

function selectAll(a){document.getElementById(a).focus(),document.getElementById(a).select()}function holdit(a,b,c,d){var e,f=function(){console.log("down"),c<250&&b(),e=setTimeout(f,c),c/=d};a.onmousedown=function(){f()},a.onmouseup=function(){clearTimeout(e),c=500}}function init(){Calculator.init(),CalculatorUI.init(),fixNonChromeBrowsers()}function factorial(a){r=1;for(i=1;i<=a;i++)r*=i;return r}function gradToRad(a){return a*Math.PI/180}function logab(a,b){return Math.log(a)/Math.log(b)}function lgn(a){return Math.log(a)/Math.log(10)}function toHex(a){return a.toString(16)}function fromHex(a){return parseInt(a.toString())}function binBase(a,b,c){return parseInt(a.toString(),c||10).toString(b)}function bin(a){return binBase(a,2,10)}function dec(a){return binBase(a,10,2)}function mod(a,b){return a%b}function fixNonChromeBrowsers(){$.browser.webkit||$(".recommend").css("display","none")}var funcEditLined=!1,roundAfter=9e-7,digitsAfterPoint=11,Calculator={init:function(){$("#input").keyup(this.inputChange),this.evalCustomFunctions()},historyPoint:0,inputChange:function(a){var b=document.getElementById("input");Calculator.normalizeInputFontSize(b);if(a.keyCode==13||a=="manual")Calculator.calculate(b),Calculator.historyPoint=0;else if(a.keyCode==38){var c=$($("#history").children("li")[Calculator.historyPoint]).children(".record").html();$(this).val(Calculator.extractInputFromResult(c)),Calculator.historyPoint+=1}else if(a.keyCode==40){var c=$($("#history").children("li")[Calculator.historyPoint-1]).children(".record").html();$(this).val(Calculator.extractInputFromResult(c)),Calculator.historyPoint>0&&(Calculator.historyPoint-=1)}else a.keyCode==27?(b.value="",Calculator.historyPoint=0):Calculator.historyPoint=0},normalizeInputFontSize:function(a){var b=a.value.length;b>24?a.style.font="bold 40px 'Century Gothic', Helvetica, sans":a.style.fontSize="64px"},calculate:function(input){var inputValue=input.value,valid=/^[a-z0-9A-Z\-\*\+\/\(\)\.\,=,\^,!,#,\s,\%]+$/.test(inputValue);if(valid&&inputValue!=""){var originalInput=inputValue,output="E";inputValue=this.inputFormat(input);try{output=eval(inputValue)}catch(e){output="E"}output==originalInput?output="":output!="E"&&(output=this.approximate(output),HistoryManager.registerChange(originalInput+" = "+output,output)),input.value=output}else input.value="E"},inputFormat:function(a){return inputValue=a.value,inputValue=inputValue.replace(/\s/g,""),inputValue=inputValue.replace(/sqrt/g,"Math.sqrt"),inputValue=inputValue.replace(/([a-z0-9\.]+|\([a-z0-9\(\)\.\-\*\+\/]+\))\^([a-z0-9\.]+|\([a-z0-9\(\)\.\-\*\+\/]+\))/g,"pow($1, $2)"),inputValue=inputValue.replace(/([a-z0-9\.]+|\([a-z0-9\(\)\.\-\*\+\/]+\))!/g,"factorial($1)"),inputValue=inputValue.replace(/#([a-z0-9\.]+|\([a-z0-9\(\)\.\-\*\+\/]+\))/g,"gradToRad($1)"),inputValue=inputValue.replace(/abs/g,"Math.abs"),inputValue=inputValue.replace(/%/g,"/100*"),inputValue=inputValue.replace(/acos/g,"Math.acos"),inputValue=inputValue.replace(/asin/g,"Math.asin"),inputValue=inputValue.replace(/atan2/g,"Math.atan2"),inputValue=inputValue.replace(/([^a])cos/g,"$1Math.cos"),inputValue=inputValue.replace(/([^a])sin/g,"$1Math.sin"),inputValue=inputValue.replace(/([^a])tan/g,"$1Math.tan"),inputValue=inputValue.replace(/^cos/g,"Math.cos"),inputValue=inputValue.replace(/^sin/g,"Math.sin"),inputValue=inputValue.replace(/^tan/g,"Math.tan"),inputValue=inputValue.replace(/atan([^2])/g,"Math.atan$1"),inputValue=inputValue.replace(/atan$/g,"Math.atan"),inputValue=inputValue.replace(/ceil/g,"Math.ceil"),inputValue=inputValue.replace(/exp/g,"Math.exp"),inputValue=inputValue.replace(/floor/g,"Math.floor"),inputValue=inputValue.replace(/log/g,"logab"),inputValue=inputValue.replace(/lg/g,"lgn"),inputValue=inputValue.replace(/ln/g,"Math.log"),inputValue=inputValue.replace(/base/g,"base"),inputValue=inputValue.replace(/bin/g,"bin"),inputValue=inputValue.replace(/dec/g,"dec"),inputValue=inputValue.replace(/max/g,"Math.max"),inputValue=inputValue.replace(/min/g,"Math.min"),inputValue=inputValue.replace(/pow/g,"Math.pow"),inputValue=inputValue.replace(/random/g,"Math.random()"),inputValue=inputValue.replace(/round/g,"Math.round"),inputValue=inputValue.replace(/([\-\*\+\/\(\)\s])e/g,"$1Math.E"),inputValue=inputValue.replace(/^e/g,"Math.E"),inputValue=inputValue.replace(/([\-\*\+\/\(\)\s])pi/g,"$1Math.PI"),inputValue=inputValue.replace(/^pi/g,"Math.PI"),inputValue=inputValue.replace(/answer/g,"42"),inputValue},approximate:function(a){return Math.abs(a-Math.round(a))>0&&(dig=Math.pow(10,digitsAfterPoint),a=Math.round(a*dig)/dig),Math.abs(a-Math.round(a))<roundAfter&&(a=Math.round(a)),a},evalCustomFunctions:function(){try{eval(localStorage.getItem("customFuncs"))}catch(e){}},extractInputFromResult:function(a){var b=a,c=b.indexOf("="),d=b;return c>-1&&(d=d.substr(0,c-1)),d}},CalculatorUI={init:function(){this.checkPendingOmniboxInput(),this.initOutput(),this.initKeypad()},checkPendingOmniboxInput:function(){var a=localStorage.getItem("fromOmnibox");a!=null&&a!="null"&&($("#input").val(a),$("#input").change())},initOutput:function(){HistoryManager.renderFromLocalStorage(),$("#clean").click(this.onCleanClick)},onCommentEditTriggerClick:function(){if($(this).html()==="Save"){var a=$(this).parent().children("input"),b=parseInt($(this).parent().parent().children(".h-index").html())-1,c=a.val();HistoryManager.updateComment(b,c),c==""||c=="Save"?(c="Add Comment",$(this).removeClass("h-action-comment"),$(this).addClass("h-action-no-comment")):($(this).removeClass("h-action-no-comment"),$(this).addClass("h-action-comment")),$(this).html(c),a.remove()}else{var d=document.createElement("input");$(d).addClass("h-comment-editor");var e=this;$(d).keypress(function(a){a.keyCode==13&&$(e).click()});var f=$(this).html();f!="Add Comment"&&$(d).val(f),$(this).parent().prepend(d),$(d).focus(),$(this).html("Save")}},onRecordClick:function(){var a=$(this).html(),b=Calculator.extractInputFromResult(a);$("#input").val(b),document.getElementById("input").focus()},onRemoveRecordClick:function(){var a=parseInt($(this).parent().find(".h-index").html());HistoryManager.removeHistoryRecord(a),$(this).parent().fadeOut("fast")},onCleanClick:function(){HistoryManager.cleanHistory()},initKeypad:function(){$("#keypad-icon").click(function(){var a=0;$("#input-buttons").css("display")=="none"?($(this).css("opacity","1"),a=parseInt($("#history-box").css("height")),$("#history-box").css("height",a-246),$("#input-buttons").fadeIn("fast"),localStorage.setItem("calculatorKeyPad","true")):($(this).css("opacity","0.5"),a=parseInt($("#history-box").css("height")),$("#input-buttons").fadeOut("fast",function(){$("#history-box").css("height",a+246)}),localStorage.setItem("calculatorKeyPad","false"))});var a=localStorage.getItem("calculatorKeyPad");a=="true"&&$("#keypad-icon").click(),$(".kp-button").click(this.keypadKeyClick),holdit(document.getElementById("clear-keypad-button"),function(){input.value=""},500,2)},keypadKeyClick:function(){var a=$(input).val();if($(this).hasClass("kp-back"))a.length>0&&$(input).val(a.substr(0,a.length-1));else if($(this).hasClass("kp-eql"))Calculator.calculate(document.getElementById("input"));else{if(a=="0"||a=="E")a="";var b;$(this).attr("stringToAppend")==null?b=$(this).html():b=$(this).attr("stringToAppend"),$(input).val(a+b)}},utils:{createLiActivater:function(a,b){$(a).find(".record").each(function(){var a=$(this),c;b=="parent"?c=a.parent():c=$(b),a.unbind("mousedown"),a.mousedown(function(){c.addClass("active")}),a.unbind("mouseup"),a.mouseup(function(){c.removeClass("active")})})}}},HistoryManager={recordsCount:0,records:[],renderFromLocalStorage:function(){this.records=$.parseJSON(localStorage.getItem("calculatorHistory")),this.records==null&&(this.records=[]);var a=0;for(var b in this.records){var c=this.records[b];this.addRecord(c[0],c[1],c[2]),a+=1,this.recordsCount=a}a==0?this.onHistoryClean():this.onHistoryHasItems()},addRecord:function(a,b,c){var d=c==undefined||c=="";c=d?"Add Comment":c,commentClass=d?"h-action-no-comment":"h-action-comment";var e=document.createElement("li"),f='<span class="h-index">'+(this.recordsCount+1)+'</span><span class="remove-history-record">&times;</span> <span result="'+b+'" class="record">'+a+'</span><div class="h-actions"><span class="h-comment-edit-trigger '+commentClass+'">'+c+"</span></div>";$(e).append(f),$("#history-box ol").prepend(e),CalculatorUI.utils.createLiActivater(e,"parent"),$(e).find(".h-comment-edit-trigger").click(CalculatorUI.onCommentEditTriggerClick),$(e).find(".record").click(CalculatorUI.onRecordClick),$(e).find(".remove-history-record").click(CalculatorUI.onRemoveRecordClick)},registerChange:function(a,b){this.addRecord(a,b,""),this.records.push([a,b,""]),this.recordsCount=this.recordsCount+1,this.saveRecordsToLocalStorage(),this.onHistoryHasItems()},saveRecordsToLocalStorage:function(){localStorage.setItem("calculatorHistory",JSON.stringify(this.records))},updateComment:function(a,b){b=b=="Save"?"":b,this.records[a][2]=b,this.saveRecordsToLocalStorage()},onHistoryClean:function(){$(".h-placeholder").css("display","block"),$(".history-tools").css("display","none")},onHistoryHasItems:function(){$(".h-placeholder").css("display","none"),$(".history-tools").css("display","block")},cleanHistory:function(){this.records=[],this.recordsCount=0,this.saveRecordsToLocalStorage(),$("#history-box ol").html(""),this.onHistoryClean()},removeHistoryRecord:function(a){this.records.splice(a,1),this.recordsCount-=1,this.saveRecordsToLocalStorage(),$("#history").find("li").each(function(){var b=parseInt($(this).children(".h-index").html());b>a&&$(this).children(".h-index").html(b-1)}),this.recordsCount==0&&this.cleanHistory()}}
